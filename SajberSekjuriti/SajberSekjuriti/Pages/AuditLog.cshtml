@page
@model SajberSekjuriti.Pages.AuditLogModel
@{
    ViewData["Title"] = "Logi Aktywności Użytkowników";
}

<h1>@ViewData["Title"]</h1>
<p>Rejestr zdarzeń w systemie.</p>

@* --- Formularz filtrowania (bez zmian) --- *@
<form method="get" class="border p-3 mb-4 rounded bg-light">
    <div class="row g-3 align-items-end">

        <div class="col-md-3">
            <label asp-for="SearchUsername" class="form-label">Nazwa użytkownika</label>
            <input asp-for="SearchUsername" class="form-control" placeholder="Wpisz fragment nazwy..." />
        </div>

        <div class="col-md-3">
            <label asp-for="SearchAction" class="form-label">Akcja</label>
            <select asp-for="SearchAction" asp-items="Model.ActionTypes" class="form-select">
                <option value="">Wszystkie akcje</option>
            </select>
        </div>

        <div class="col-md-2">
            <label asp-for="StartDate" class="form-label">Data od</label>
            <input asp-for="StartDate" type="date" class="form-control" />
        </div>

        <div class="col-md-2">
            <label asp-for="EndDate" class="form-label">Data do</label>
            <input asp-for="EndDate" type="date" class="form-control" />
        </div>

        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Filtruj</button>
            <a asp-page="/AuditLog" class="btn btn-secondary w-100 mt-1">Wyczyść</a>
        </div>
    </div>
</form>

@* --- Tabela (bez zmian) --- *@
<table class="table table-striped table-sm">
    <thead>
        <tr>
            <th>Użytkownik</th>
            <th>Data i Czas (UTC)</th>
            <th>Akcja</th>
            <th>Opis</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var log in Model.Logs)
        {
            <tr>
                <td>@log.Username</td>
                <td>@log.Timestamp.ToString("g")</td>
                <td>@log.Action</td>
                <td>@log.Description</td>
            </tr>
        }
    </tbody>
</table>

@* --- NOWA SEKCJA PAGINACJI --- *@
@if (Model.TotalPages > 0)
{
    <div class="d-flex justify-content-between align-items-center mt-3">

        @* Informacja o stronie *@
        <div>
            Strona <strong>@Model.CurrentPage</strong> z <strong>@Model.TotalPages</strong>
            (Łącznie przefiltrowanych logów: @Model.TotalItems)
        </div>

        @* Przyciski Poprzednia/Następna *@
        <nav>
            <ul class="pagination mb-0">

                @* Przycisk POPRZEDNIA *@
                @{
                    // Wyłączamy przycisk, jeśli jesteśmy na pierwszej stronie
                    var prevDisabled = Model.CurrentPage == 1 ? "disabled" : "";
                }
                <li class="page-item @prevDisabled">
                    <a class="page-link" asp-page="/AuditLog"
                       asp-route-CurrentPage="@(Model.CurrentPage - 1)"
                       asp-route-SearchUsername="@Model.SearchUsername"
                       asp-route-SearchAction="@Model.SearchAction"
                       asp-route-StartDate="@Model.StartDate?.ToString("yyyy-MM-dd")"
                       asp-route-EndDate="@Model.EndDate?.ToString("yyyy-MM-dd")">
                        Poprzednia
                    </a>
                </li>

                @* Przycisk NASTĘPNA *@
                @{
                    // Wyłączamy przycisk, jeśli jesteśmy na ostatniej stronie
                    var nextDisabled = Model.CurrentPage == Model.TotalPages ? "disabled" : "";
                }
                <li class="page-item @nextDisabled">
                    <a class="page-link" asp-page="/AuditLog"
                       asp-route-CurrentPage="@(Model.CurrentPage + 1)"
                       asp-route-SearchUsername="@Model.SearchUsername"
                       asp-route-SearchAction="@Model.SearchAction"
                       asp-route-StartDate="@Model.StartDate?.ToString("yyyy-MM-dd")"
                       asp-route-EndDate="@Model.EndDate?.ToString("yyyy-MM-dd")">
                        Następna
                    </a>
                </li>
            </ul>
        </nav>
    </div>
}
@* --- KONIEC SEKCJI PAGINACJI --- *@